<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hdmax2 application • hdmax2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="hdmax2 application">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hdmax2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/hdmax2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>hdmax2 application</h1>
                        <h4 data-toc-skip class="author">Florence
Pittion, Magali Richard, Olivier Francois</h4>
            
            <h4 data-toc-skip class="date">January, 2024</h4>
      

      <div class="d-none name"><code>hdmax2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When a statistical association is observed between an external
exposure
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>)
and an individual outcome
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>),
one or more intermediate variables (<strong>M</strong>) (such as gene
expression or epigenetic changes) may mediate this effect. Identifying
and assessing the mediating role of these variables in the effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
is crucial for deciphering underlying causal mechanisms in
epidemiological and clinical research. This process, known as mediation
analysis, involves studying mediator variables to define the causal
structure between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.
The mediated effect, termed the indirect effect, is equal to the effect
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
mediated through (<strong>M</strong>), to distinguish from the direct
effect of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
unexplained by (<strong>M</strong>).</p>
<p>The R package <code>hdmax2</code> is dedicated to high-dimensional
mediation analyses. For mediation analyses, the necessary data includes
one (or more) exposure variable(s), a matrix of potential mediators, and
an outcome variable.</p>
<p>The term “high dimensional” refers to the large quantity of potential
mediators among which we seek to identify the actual mediators.</p>
<p>The fundamental concept behind HDMAX2 methods is to use a latent
factor mixed regression model for estimating unobserved latent factors
while conducting high-dimensional association analysis. HDMAX2 also
implements a novel procedure known as the max-squared test to assess the
statistical significance of potential mediators. Finally, HDMAX2 enables
the calculation of an overall indirect effect from a single model that
includes all mediators simultaneously. This approach therefore takes
into account correlations between mediators.</p>
<p>The <code>hdmax2</code> program has been enriched with numerous
features, including the ability to manage various types of variables in
the exposure (continuous, binary, categorical, and multivariate), as
well as the capability to incorporate binary outcomes. This package
enables users to:</p>
<ul>
<li><p>investigate associations between the variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
(<strong>M</strong>), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,</p></li>
<li><p>compute the mediated effect for each potential mediator,</p></li>
<li><p>assess the overall indirect effect for the total model,</p></li>
<li><p>and visualize these results.</p></li>
</ul>
<p>The package <code>hdmax2</code> is designed to accept :</p>
<ul>
<li><p>One or several Exposure variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
consisting of univariate data, which can be continuous, binary or
categorical as well as multivariate exposure. We define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
as the number of samples within the tested cohort. Therefore, each
exposure and outcome variable consists of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
measurements. In the <code>R</code> language, categorical variables are
encoded as factor objects. The function <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code> can be
used to encode categorical variables. The functions
<code><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels()</a></code> and <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered()</a></code> can be used to define
the order of the modalities of categorical variables. By convention,
<code>hdmax2</code> uses the first modality as a reference to calculate
the effects associated with the other modalities of the variable, as
encoded by default in statistical regression models in
<code>R</code>.</p></li>
<li><p>Continuous intermediary variables, denoted as <strong>M</strong>,
are represented as a matrix encompassing potential mediators, such as
methylome or transcriptome molecular features. The matrix
<strong>M</strong> should be entered as a separated input, without
missing values. The intermediary variable matrix <strong>M</strong> is
of dimension
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">n \times p</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
the total number of intermediate variables.</p></li>
<li><p>The outcome variable, denoted as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
corresponds to a vector of dimension
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
which supports both continuous and binary formats. Continuous and binary
variables must be encoded in numeric format.</p></li>
<li><p>Optional covariates,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
can be included as observed adjustment factors in the model. Please
refer to the helper function section for insight into how to interpret
the additional set of covariates.</p></li>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>,
the number of latent factors to be estimated.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="example-simulation-multivariate-exposure-and-continuous-outcome">Example (simulation) : <em>multivariate exposure</em> and
<em>continuous outcome</em><a class="anchor" aria-label="anchor" href="#example-simulation-multivariate-exposure-and-continuous-outcome"></a>
</h2>
<p>For this example we use a <strong>two variables exposure</strong>
(continuous and binary), a <strong>continuous outcome</strong> and
<strong>two adjustment factors</strong> (age and gender).</p>
<p>We simulated data for 100 samples and 1000 potential mediators.</p>
<p>The matrix of potential mediators is an extract of real methylation
data (TCGA PDAC samples).</p>
<p>We define the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
number of estimated latent factors by performing a PCA on potential
mediators matrix. Cattell’s rule is applied to the eigenvalues of PCA.
The scree plot criterion looks for the “elbow” in the curve and selects
all components just before the line flattens out,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
is chosen with this procedure.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simu_data</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="va"><a href="../reference/simu_data.html">simu_data</a></span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Number of Latent factor estimation</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">simu_data</span><span class="op">$</span><span class="va">M1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Principal Component'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Explained variance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/pca%20for%20latent%20factor-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">K</span><span class="op">=</span><span class="fl">4</span> <span class="co">#pca conclusion : it is better to select too many factors than too few</span></span></code></pre></div>
<div class="section level3">
<h3 id="step-1-run-association-studies">STEP 1: Run association studies<a class="anchor" aria-label="anchor" href="#step-1-run-association-studies"></a>
</h3>
<p>The <code>run_AS</code> function is applied:</p>
<ul>
<li><p>First to estimate latent factors with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>f</mi><mi>m</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">lfmm</annotation></semantics></math>
algorithms.</p></li>
<li><p>Then to identify significant effects of exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on potential mediators in <strong>M</strong> matrix, and significant
effect of potential mediators on outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p></li>
<li><p>And eventually to compute mediation test: <em>max-squared</em>
test.</p></li>
</ul>
<p>The <code>run_AS</code> function takes as inputs:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
for exposure: can be a vector, a factor with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
(samples) elements or a data frame with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows and 1 column if univariate or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
columns or different exposure variables if multivariate.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
for outcome: can be a vector or a matrix with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows and 1 column.</li>
<li>
<strong>M</strong> for the potential mediators: must be a matrix
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
columns (potential mediators).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
for the number of latent factors defined earlier: must be integer.</li>
<li>Adjustment factors <em>covar</em> can be included: must be numeric
(data frame or matrix) with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## multivariate Exposures (continuous + binary)</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_continuous <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">X_continuous</span>, X_binary <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">X_binary</span><span class="op">)</span></span>
<span><span class="va">covar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">simu_data</span><span class="op">$</span><span class="va">age</span>, <span class="va">simu_data</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span></span>
<span><span class="va">covar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">covar</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hdmax2_step1</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/run_AS.html">run_AS</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">X</span> ,</span>
<span>                              outcome <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">Y_continuous</span>,</span>
<span>                              M <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">M2</span>,</span>
<span>                              K <span class="op">=</span> <span class="va">K</span>,</span>
<span>                              covar <span class="op">=</span> <span class="va">covar</span><span class="op">)</span></span></code></pre></div>
<p>The <code>run_AS</code> function provides an object containing:</p>
<ul>
<li>Results from the two association studies
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values,
fscores or zscores),</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_1</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cg00005740    cg00006787    cg00007032    cg00008612    cg00009871 </span></span>
<span><span class="co">#&gt; 6.385434e-110  7.557479e-86 3.515170e-127  5.140365e-98 8.322935e-110 </span></span>
<span><span class="co">#&gt;    cg00009922 </span></span>
<span><span class="co">#&gt;  7.946406e-11</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_2</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cg00005740   cg00006787   cg00007032   cg00008612   cg00009871   cg00009922 </span></span>
<span><span class="co">#&gt; 6.540743e-04 1.186044e-01 7.450322e-08 1.549392e-07 1.007703e-04 5.130813e-01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cg00005740   cg00006787   cg00007032   cg00008612   cg00009871   cg00009922 </span></span>
<span><span class="co">#&gt; 4.278131e-07 1.406700e-02 5.550730e-15 2.400616e-14 1.015465e-08 2.632524e-01</span></span></code></pre></div>
<p>At this stage, we can use the figure below to assess two assumptions:
panel A evaluates the independence of the two p-value vectors from two
association studies (showing weak correlation), while panel B examines
the uniformity of max2 test p-values (except for values near 0).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">pval1</span> <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_1</span><span class="op">$</span><span class="va">pval</span></span>
<span><span class="va">pval2</span> <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_2</span><span class="op">$</span><span class="va">pval</span></span>
<span><span class="va">cor_value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">pval1</span>,<span class="va">pval2</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pval1</span>, y <span class="op">=</span> <span class="va">pval2</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pval1</span>, y <span class="op">=</span> <span class="va">pval2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bin_2d.html" class="external-link">geom_bin2d</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"lightblue"</span>, high <span class="op">=</span> <span class="st">"darkblue"</span>, </span>
<span>                      guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"correlation\n = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_value</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"\n \n Count"</span><span class="op">)</span>, </span>
<span>                                             title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"1srt regresssion (X-&gt;M) pvalues"</span>, y <span class="op">=</span> <span class="st">"2nd regresssion (M-&gt;Y) pvalues"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_hdmax2_step1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pvalues <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_hdmax2_step1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pvalues</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B"</span>, x <span class="op">=</span> <span class="st">"Max2 test pvalues distribution"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span> <span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, top <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="st">"Hypothesis verification"</span>, gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/step%201%20check%20assumption%20plot-1.png" width="1152"></p>
<ul>
<li>Latent factors estimation matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
columns) from first regression,</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_1</span><span class="op">$</span><span class="va">U</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]       [,2]       [,3]       [,4]</span></span>
<span><span class="co">#&gt; [1,] -12.585133 -1.1510431  0.3444928  0.1350501</span></span>
<span><span class="co">#&gt; [2,]   3.406759  0.5755978 -0.7455638 -0.5796212</span></span>
<span><span class="co">#&gt; [3,]   7.942628  1.7442171 -1.0279125 -0.5658921</span></span>
<span><span class="co">#&gt; [4,]   2.884806  0.8904630 -0.3638173 -0.5666794</span></span>
<span><span class="co">#&gt; [5,]  -9.200969 -0.9469759  0.3270254  0.1069010</span></span>
<span><span class="co">#&gt; [6,]  14.865324  1.9505182 -1.3129179 -0.9547634</span></span></code></pre></div>
<ul>
<li><p><code>run_AS</code> function’s inputs,</p></li>
<li><p>And <em>max-squared</em> test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
results.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cg00005740   cg00006787   cg00007032   cg00008612   cg00009871   cg00009922 </span></span>
<span><span class="co">#&gt; 4.278131e-07 1.406700e-02 5.550730e-15 2.400616e-14 1.015465e-08 2.632524e-01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="selection-of-a-subset-of-mediators">Selection of a subset of mediators<a class="anchor" aria-label="anchor" href="#selection-of-a-subset-of-mediators"></a>
</h3>
<p><em>max-squared</em>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
are used in the selection of mediators for the user’s chosen method.</p>
<p>Numerous selection methods are available, such as FDR control. Also
in the context of methylation data, it’s feasible to to identify
aggregated mediator regions (AMR) based on the paired
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
frome mediation test. Refer to the <em>helper_functions</em> vignette
for assistance FDR control and AMR researching procedure.</p>
<p>For the example, we opted for the top ten most significant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
from the <em>max-squared</em> test.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Selecting top 10 mediators</span></span>
<span><span class="va">mediators_top10</span> <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">M2</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mediators_top10</span><span class="op">)</span></span>
<span><span class="co">#&gt;            cg00025981 cg00075768 cg00019093 cg00066729 cg00031759 cg00084432</span></span>
<span><span class="co">#&gt; GSM1051525   1.685693   2.218030   1.557068   2.430756   1.691808   3.780360</span></span>
<span><span class="co">#&gt; GSM1051526   6.161752   5.784076   5.691395   5.489877   6.089739   8.069034</span></span>
<span><span class="co">#&gt; GSM1051527   7.679215   6.889730   7.079877   6.397163   7.563050   9.386660</span></span>
<span><span class="co">#&gt; GSM1051528   6.431278   5.836811   5.913431   5.450084   6.318493   8.108019</span></span>
<span><span class="co">#&gt; GSM1051529   2.266971   2.807172   2.098831   3.032556   2.256564   4.550265</span></span>
<span><span class="co">#&gt; GSM1051530   7.782111   7.576316   7.183111   7.398095   7.658832  10.399671</span></span>
<span><span class="co">#&gt;            cg00076854 cg00007032 cg00008612 cg00022633</span></span>
<span><span class="co">#&gt; GSM1051525   1.966973   1.431224   2.318326   1.459519</span></span>
<span><span class="co">#&gt; GSM1051526   4.500903   5.076067   6.277443   5.195897</span></span>
<span><span class="co">#&gt; GSM1051527   5.262907   6.293432   7.585078   6.470071</span></span>
<span><span class="co">#&gt; GSM1051528   4.485116   5.290542   6.481324   5.401831</span></span>
<span><span class="co">#&gt; GSM1051529   2.456586   1.900969   2.779885   1.940046</span></span>
<span><span class="co">#&gt; GSM1051530   5.998859   6.406738   7.633106   6.566717</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2">STEP 2<a class="anchor" aria-label="anchor" href="#step-2"></a>
</h3>
<p>The function <code>estimate_effect</code> estimate the individual
indirect effect of mediators, but also overall effects of selected
mediators.</p>
<p>The function <code>estimate_effect</code> takes as inputs, step 1
object and selected mediators matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>M</mi><mi>S</mi></msup><annotation encoding="application/x-tex">M^S</annotation></semantics></math>
from chosen selection method apply on <em>max-squared</em> test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdmax2_step2</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/estimate_effect.html">estimate_effect</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">hdmax2_step1</span>,</span>
<span>                                       m <span class="op">=</span> <span class="va">mediators_top10</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>estimate_effect</code> use
<code><a href="https://rdrr.io/pkg/mediation/man/mediate.html" class="external-link">mediation::mediate</a></code> function to obtain several effects
estimation with uncertainty:</p>
<ul>
<li>ACME Average Causal Mediation Effect: corresponding to the indirect
effect</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For first exposure variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X1</span><span class="op">$</span><span class="va">ACME</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="co"># For second exposure variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X2</span><span class="op">$</span><span class="va">ACME</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<ul>
<li>PM Proportion Mediate: corresponding to the proportion of the total
effect that is mediated by the mediator</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For first exposure variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">PM</span><span class="op">)</span></span>
<span><span class="co">#&gt;           est      CI_2.5     CI_97.5  pval       feat</span></span>
<span><span class="co">#&gt; 1  0.07793461 -0.14768424  0.30034760 0.468 cg00025981</span></span>
<span><span class="co">#&gt; 2 -0.18706776 -0.27319809 -0.10068413 0.000 cg00075768</span></span>
<span><span class="co">#&gt; 3  0.14686163 -0.06269033  0.37856293 0.154 cg00019093</span></span>
<span><span class="co">#&gt; 4 -0.11709747 -0.15242776 -0.07750990 0.000 cg00066729</span></span>
<span><span class="co">#&gt; 5  0.01346451 -0.14562168  0.18337909 0.882 cg00031759</span></span>
<span><span class="co">#&gt; 6 -0.09018552 -0.13777651 -0.04434364 0.000 cg00084432</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_binary</span><span class="op">$</span><span class="va">PM</span><span class="op">)</span></span>
<span><span class="co">#&gt;           est      CI_2.5     CI_97.5  pval       feat</span></span>
<span><span class="co">#&gt; 1  0.08691151 -0.12080763  0.29644228 0.432 cg00025981</span></span>
<span><span class="co">#&gt; 2 -0.19477614 -0.29052451 -0.09616481 0.000 cg00075768</span></span>
<span><span class="co">#&gt; 3  0.13953217 -0.04426333  0.35891488 0.164 cg00019093</span></span>
<span><span class="co">#&gt; 4 -0.11924912 -0.15757274 -0.08046365 0.000 cg00066729</span></span>
<span><span class="co">#&gt; 5  0.01682250 -0.16406513  0.18895125 0.854 cg00031759</span></span>
<span><span class="co">#&gt; 6 -0.09207909 -0.14035110 -0.04339033 0.000 cg00084432</span></span></code></pre></div>
<ul>
<li>TE total effect: which is equal to the sum of direct and indirect
effect</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For first exposure variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">TE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          est     CI_2.5    CI_97.5 pval       feat</span></span>
<span><span class="co">#&gt; 1 -0.6079588 -0.6106614 -0.6053151    0 cg00025981</span></span>
<span><span class="co">#&gt; 2 -0.6078334 -0.6103544 -0.6050415    0 cg00075768</span></span>
<span><span class="co">#&gt; 3 -0.6079978 -0.6106669 -0.6054574    0 cg00019093</span></span>
<span><span class="co">#&gt; 4 -0.6080833 -0.6107622 -0.6053750    0 cg00066729</span></span>
<span><span class="co">#&gt; 5 -0.6079325 -0.6106565 -0.6052642    0 cg00031759</span></span>
<span><span class="co">#&gt; 6 -0.6078076 -0.6104230 -0.6052371    0 cg00084432</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_binary</span><span class="op">$</span><span class="va">TE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          est     CI_2.5    CI_97.5 pval       feat</span></span>
<span><span class="co">#&gt; 1 -0.6070015 -0.6090468 -0.6049175    0 cg00025981</span></span>
<span><span class="co">#&gt; 2 -0.6067137 -0.6088539 -0.6045375    0 cg00075768</span></span>
<span><span class="co">#&gt; 3 -0.6070108 -0.6091154 -0.6049133    0 cg00019093</span></span>
<span><span class="co">#&gt; 4 -0.6068201 -0.6089097 -0.6048201    0 cg00066729</span></span>
<span><span class="co">#&gt; 5 -0.6069953 -0.6090666 -0.6049249    0 cg00031759</span></span>
<span><span class="co">#&gt; 6 -0.6068186 -0.6089037 -0.6045198    0 cg00084432</span></span></code></pre></div>
<ul>
<li>ADE Average Direct Effect: which represents the unmediated
effect.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For first exposure variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">ADE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          est     CI_2.5    CI_97.5 pval       feat</span></span>
<span><span class="co">#&gt; 1 -0.5601282 -0.6990500 -0.4254862    0 cg00025981</span></span>
<span><span class="co">#&gt; 2 -0.7216112 -0.7749001 -0.6703574    0 cg00075768</span></span>
<span><span class="co">#&gt; 3 -0.5170829 -0.6449217 -0.3785875    0 cg00019093</span></span>
<span><span class="co">#&gt; 4 -0.6793718 -0.7008739 -0.6552783    0 cg00066729</span></span>
<span><span class="co">#&gt; 5 -0.5975570 -0.6973984 -0.4960193    0 cg00031759</span></span>
<span><span class="co">#&gt; 6 -0.6631018 -0.6921840 -0.6346139    0 cg00084432</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_binary</span><span class="op">$</span><span class="va">ADE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          est     CI_2.5    CI_97.5 pval       feat</span></span>
<span><span class="co">#&gt; 1 -0.5545354 -0.6808834 -0.4268651    0 cg00025981</span></span>
<span><span class="co">#&gt; 2 -0.7243052 -0.7838235 -0.6649691    0 cg00075768</span></span>
<span><span class="co">#&gt; 3 -0.5187455 -0.6330178 -0.3898110    0 cg00019093</span></span>
<span><span class="co">#&gt; 4 -0.6791212 -0.7021317 -0.6556569    0 cg00066729</span></span>
<span><span class="co">#&gt; 5 -0.5962429 -0.7068583 -0.4910823    0 cg00031759</span></span>
<span><span class="co">#&gt; 6 -0.6630343 -0.6919211 -0.6327212    0 cg00084432</span></span></code></pre></div>
<p>This step also compute Overall effects :</p>
<ul>
<li>OIE (Indirect effect): corresponding to the sum of the indirect
effect associated with all mediators.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate OIE for first exposure variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">oie</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.2958142 -0.1508090 -0.3900808 -0.1246276 -0.2151548 -0.1401295</span></span>
<span><span class="co"># OIE median for first exposure variable</span></span>
<span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">oie_med</span></span>
<span><span class="co">#&gt; [1] -0.1933182</span></span>
<span><span class="co"># OIE standard deviation for first exposure variable</span></span>
<span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">oie_sd</span></span>
<span><span class="co">#&gt; [1] 0.08165734</span></span></code></pre></div>
<ul>
<li>ODE (Direct Effect): corresponding to the effect of exposure
variables on the outcome variable.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">ode</span></span>
<span><span class="co">#&gt;      Estimate    Std. Error       t value      Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt; -4.138240e-01  8.050834e-02 -5.140138e+00  1.794390e-06</span></span></code></pre></div>
<ul>
<li>OTE (Total Effect): corresponding to the effect of exposure
variables on the outcome variable when the mediators
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>M</mi><mi>S</mi></msup><annotation encoding="application/x-tex">M^S</annotation></semantics></math>
are included in the model.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">ote</span></span>
<span><span class="co">#&gt;       Estimate     Std. Error        t value       Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt;  -6.080365e-01   1.337064e-03  -4.547549e+02  1.856535e-157</span></span></code></pre></div>
<p>In addition, function <code>estimate_effect</code> estimates the
intermediary effect sizes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>j</mi></msub><annotation encoding="application/x-tex">a_j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>j</mi></msub><annotation encoding="application/x-tex">b_j</annotation></semantics></math>
and their standard deviations.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">xm</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Estimate   Std.Error   t.Value        pValue       feat</span></span>
<span><span class="co">#&gt; 1 4.2259065 0.009426571 448.29732 5.704808e-154 cg00025981</span></span>
<span><span class="co">#&gt; 2 1.9188493 0.009315837 205.97713 2.872086e-123 cg00075768</span></span>
<span><span class="co">#&gt; 3 3.8615528 0.009380363 411.66348 1.329727e-150 cg00019093</span></span>
<span><span class="co">#&gt; 4 0.7093047 0.007568283  93.72068  2.624847e-92 cg00066729</span></span>
<span><span class="co">#&gt; 5 4.1366585 0.012411325 333.29708 2.910289e-142 cg00031759</span></span>
<span><span class="co">#&gt; 6 1.7521157 0.017207734 101.82141  1.490810e-95 cg00084432</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">X_continuous</span><span class="op">$</span><span class="va">my</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Estimate   Std.Error    t.Value       pValue       feat</span></span>
<span><span class="co">#&gt; 1 -0.012063552 0.016128696 -0.7479558 4.563945e-01 cg00025981</span></span>
<span><span class="co">#&gt; 2  0.059815480 0.015016868  3.9832193 1.358342e-04 cg00075768</span></span>
<span><span class="co">#&gt; 3 -0.023244544 0.016497605 -1.4089648 1.622166e-01 cg00019093</span></span>
<span><span class="co">#&gt; 4  0.100847132 0.016982709  5.9382241 5.061150e-08 cg00066729</span></span>
<span><span class="co">#&gt; 5 -0.002496094 0.012440722 -0.2006390 8.414237e-01 cg00031759</span></span>
<span><span class="co">#&gt; 6  0.031741873 0.008358622  3.7975008 2.619181e-04 cg00084432</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vizualisation-of-results">Vizualisation of results<a class="anchor" aria-label="anchor" href="#vizualisation-of-results"></a>
</h3>
<p>We propose a set of plots including:</p>
<ul>
<li><p>Mediators ACME Forest plot</p></li>
<li><p>Mediators PM Forest plot</p></li>
<li><p>Comparison of ODE, OIE and OTE</p></li>
<li><p>Mediators effect size representation</p></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_hdmax2.html">plot_hdmax2</a></span><span class="op">(</span><span class="va">hdmax2_step2</span>, plot_type<span class="op">=</span> <span class="st">"all_plot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/plot%20results%20multivar%20-1.png" width="960"><img src="hdmax2_files/figure-html/plot%20results%20multivar%20-2.png" width="960"></p>
<ul>
<li><p><strong>A</strong> Estimates of indirect effect (ACME) and
<strong>B</strong> proportions of mediated effect (PM) for the top 10
mediators. The effect estimate is represented by a dot and its 95% CI by
the bar. Symbols correspond to the significance cut off of 5% (square
for p-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\geq 0.05</annotation></semantics></math>,
circle p-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">&lt; 0.05</annotation></semantics></math>).
Colors correspond to the sign of the effect (green for estimated effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\leq 0</annotation></semantics></math>
, red for estimated effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&gt; 0</annotation></semantics></math>).</p></li>
<li><p><strong>C</strong> Effect sizes of Overall Direct Effect (ODE),
Overall Indirect Effect (OIE) and Overall Total Effect (OTE). Error bars
correspond to standard deviation (ODE and OTE) or confidence interval
(OIE).</p></li>
<li><p><strong>D</strong> Indirect effect sizes for the selected
mediators. Black corresponds to the ACME, violet to the effect of
exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on mediator <strong>M</strong>, and blue corresponds to the effect of
mediator <strong>M</strong> on outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p></li>
</ul>
<p>In the <code>plot_hdmax2</code> function it is possible to produce
the 4-plots set or each individual plot with <em>plot_type</em>
argument.</p>
</div>
</div>
<div class="section level2">
<h2 id="rst-use-case-breast-cancer">1rst Use Case : Breast cancer<a class="anchor" aria-label="anchor" href="#rst-use-case-breast-cancer"></a>
</h2>
<p><code>tcga_brca</code> was downloaded and processed from the Cancer
Genome Atlas TCGA-BRCA dataset (. 2019 version of the data.)</p>
<p>It is a list of 4 matrices : X (exposure), M (potential mediators), Y
(outcome) and CF (confounding factor)) :</p>
<ul>
<li>X : exposure variable, a matrix of 904 rows (patients) and 1 column
(her-status : positive = 1 and negative = 0)</li>
<li>M : potential mediators, a matrix of 19959 rows (beta-values of CpG
probes) and 904 columns (patients)</li>
<li>Y : outcome variable, a matrix of 904 rows (patients) and 1 column
(risk-score, a continuous variable)</li>
<li>CF : confounding factor, a matrix of 904 rows (patients) and 1
column (age)</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"tcga_brca.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">url_file</span> <span class="op">&lt;-</span> <span class="st">"https://zenodo.org/records/14716548/files/tcga_brca.RData?download=1"</span></span>
<span>  <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">GET</a></span><span class="op">(</span><span class="va">url_file</span>, <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/write_disk.html" class="external-link">write_disk</a></span><span class="op">(</span><span class="st">"tcga_brca.RData"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">response</span><span class="op">$</span><span class="va">status_code</span> <span class="op">==</span> <span class="fl">200</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"tcga_brca.RData"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Download failed"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Number of Latent factore estimation</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">tcga_brca</span><span class="op">$</span><span class="va">M</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Principal Component'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Explained variance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/brca%20pca%20for%20latent%20factor-1.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">K</span> <span class="op">=</span> <span class="fl">2</span> <span class="co">#The screeplot indicates around 2 main components in the data. </span></span></code></pre></div>
<div class="section level3">
<h3 id="step-1-run-association-studies-1">STEP 1: Run association studies<a class="anchor" aria-label="anchor" href="#step-1-run-association-studies-1"></a>
</h3>
<p>The <strong>run_AS</strong> function is applied to estimate the
effects of exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on a matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
of potential mediators, and the effect of each potential mediators on
outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
.We also add the age as a known counfouding factor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">CF</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hdmax2_step1</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/run_AS.html">run_AS</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">tcga_brca</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>,</span>
<span>                              outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">tcga_brca</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>,</span>
<span>                              M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">tcga_brca</span><span class="op">$</span><span class="va">M</span><span class="op">)</span>, </span>
<span>                              K <span class="op">=</span> <span class="va">K</span>,</span>
<span>                              covar <span class="op">=</span> <span class="va">tcga_brca</span><span class="op">$</span><span class="va">CF</span><span class="op">)</span></span></code></pre></div>
<p><em>max-squared</em> test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
results.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_1</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cg00000292   cg00002426   cg00003994   cg00005847   cg00007981   cg00008493 </span></span>
<span><span class="co">#&gt; 0.0009873141 0.7773962442 0.2813067905 0.0944946938 0.1972223151 0.0626456118</span></span>
<span></span>
<span><span class="va">pval1</span> <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_1</span><span class="op">$</span><span class="va">pval</span></span>
<span><span class="va">pval2</span> <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_2</span><span class="op">$</span><span class="va">pval</span></span>
<span><span class="va">cor_value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">pval1</span>,<span class="va">pval2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pval1</span>, y <span class="op">=</span> <span class="va">pval2</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pval1</span>, y <span class="op">=</span> <span class="va">pval2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bin_2d.html" class="external-link">geom_bin2d</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"lightblue"</span>, high <span class="op">=</span> <span class="st">"darkblue"</span>, </span>
<span>                      guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"correlation\n = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_value</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"\n \n Count"</span><span class="op">)</span>, </span>
<span>                                             title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"1srt regresssion (X-&gt;M) pvalues"</span>, y <span class="op">=</span> <span class="st">"2nd regresssion (M-&gt;Y) pvalues"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_hdmax2_step1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pvalues <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_hdmax2_step1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pvalues</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B"</span>, x <span class="op">=</span> <span class="st">"Max2 test pvalues distribution"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span> <span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, top <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="st">"Hypothesis verification"</span>, gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/brca%20step%201%20res%20AS-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="selection-of-a-subset-of-mediators-1">Selection of a subset of mediators<a class="anchor" aria-label="anchor" href="#selection-of-a-subset-of-mediators-1"></a>
</h3>
<p>We selected the top 10 mediators.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Selecting top 10 mediators</span></span>
<span><span class="va">top10_max2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="va">top10_max2</span></span>
<span><span class="co">#&gt;   cg11911951   cg26530341   cg00138126   cg11203041   cg03070194   cg01804429 </span></span>
<span><span class="co">#&gt; 1.156282e-08 5.207120e-08 7.359065e-07 7.819724e-07 5.101811e-06 5.404395e-06 </span></span>
<span><span class="co">#&gt;   cg15852891   cg13760253   cg03684977   cg00400263 </span></span>
<span><span class="co">#&gt; 6.103286e-06 1.420400e-05 1.948391e-05 3.468113e-05</span></span>
<span><span class="va">mediators_top10</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">tcga_brca</span><span class="op">$</span><span class="va">M</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-1">STEP 2<a class="anchor" aria-label="anchor" href="#step-2-1"></a>
</h3>
<p>The function <code>estimate_effect</code> estimate the individual
indirect effect of mediators, but also overall effects of selected
mediators.</p>
<p>The function <code>estimate_effect</code> takes as inputs, step 1
object and selected mediators matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>M</mi><mi>S</mi></msup><annotation encoding="application/x-tex">M^S</annotation></semantics></math>
from chosen selection method apply on <em>max-squared</em> test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdmax2_step2</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/estimate_effect.html">estimate_effect</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">hdmax2_step1</span>,</span>
<span>                                       m <span class="op">=</span> <span class="va">mediators_top10</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>estimate_effect</code> use
<code><a href="https://rdrr.io/pkg/mediation/man/mediate.html" class="external-link">mediation::mediate</a></code> function to obtain several effects
estimation with uncertainty:</p>
<ul>
<li>ACME Average Causal Mediation Effect: corresponding to the indirect
effect</li>
<li>PM Proportion Mediate: corresponding to the proportion of the total
effect that is mediated by the mediator</li>
<li>TE total effect: which is equal to the sum of direct and indirect
effect</li>
<li>ADE Average Direct Effect: which represents the unmediated
effect</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">her2_status</span><span class="op">$</span><span class="va">ACME</span><span class="op">)</span></span>
<span><span class="co">#&gt;         est    CI_2.5   CI_97.5 pval       feat</span></span>
<span><span class="co">#&gt; 1 0.2750809 0.1968126 0.3615663    0 cg11911951</span></span>
<span><span class="co">#&gt; 2 0.2259850 0.1524411 0.3099751    0 cg26530341</span></span>
<span><span class="co">#&gt; 3 0.1848608 0.1139673 0.2658696    0 cg00138126</span></span>
<span><span class="co">#&gt; 4 0.2144972 0.1351034 0.2995901    0 cg11203041</span></span>
<span><span class="co">#&gt; 5 0.1980238 0.1309337 0.2675874    0 cg03070194</span></span>
<span><span class="co">#&gt; 6 0.1636311 0.1024570 0.2357561    0 cg01804429</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">her2_status</span><span class="op">$</span><span class="va">PM</span><span class="op">)</span></span>
<span><span class="co">#&gt;         est    CI_2.5  CI_97.5  pval       feat</span></span>
<span><span class="co">#&gt; 1 1.1961722 0.5718761 5.105798 0.022 cg11911951</span></span>
<span><span class="co">#&gt; 2 0.9927498 0.4544900 5.142820 0.022 cg26530341</span></span>
<span><span class="co">#&gt; 3 0.7781168 0.3486823 3.351704 0.026 cg00138126</span></span>
<span><span class="co">#&gt; 4 0.9159539 0.4104087 4.137287 0.044 cg11203041</span></span>
<span><span class="co">#&gt; 5 0.8250070 0.3559160 4.707978 0.028 cg03070194</span></span>
<span><span class="co">#&gt; 6 0.6851772 0.3085806 3.840348 0.028 cg01804429</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">her2_status</span><span class="op">$</span><span class="va">TE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         est     CI_2.5   CI_97.5  pval       feat</span></span>
<span><span class="co">#&gt; 1 0.2302655 0.03610002 0.4438003 0.022 cg11911951</span></span>
<span><span class="co">#&gt; 2 0.2280879 0.02379602 0.4384591 0.022 cg26530341</span></span>
<span><span class="co">#&gt; 3 0.2337782 0.02964313 0.4541612 0.026 cg00138126</span></span>
<span><span class="co">#&gt; 4 0.2259368 0.00763584 0.4241522 0.044 cg11203041</span></span>
<span><span class="co">#&gt; 5 0.2352299 0.02244767 0.4312680 0.028 cg03070194</span></span>
<span><span class="co">#&gt; 6 0.2302028 0.02166679 0.4276299 0.028 cg01804429</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">her2_status</span><span class="op">$</span><span class="va">ADE</span><span class="op">)</span></span>
<span><span class="co">#&gt;           est     CI_2.5   CI_97.5  pval       feat</span></span>
<span><span class="co">#&gt; 1 -0.04481544 -0.2348090 0.1616212 0.644 cg11911951</span></span>
<span><span class="co">#&gt; 2  0.00210287 -0.1966008 0.2157063 0.990 cg26530341</span></span>
<span><span class="co">#&gt; 3  0.04891740 -0.1465223 0.2600251 0.660 cg00138126</span></span>
<span><span class="co">#&gt; 4  0.01143965 -0.1909620 0.1971772 0.880 cg11203041</span></span>
<span><span class="co">#&gt; 5  0.03720611 -0.1798778 0.2428894 0.704 cg03070194</span></span>
<span><span class="co">#&gt; 6  0.06657173 -0.1558689 0.2715023 0.544 cg01804429</span></span></code></pre></div>
<p>This step also compute Overall effects :</p>
<ul>
<li>OIE (Indirect effect): corresponding to the sum of the indirect
effect associated with all mediators.</li>
<li>ODE (Direct Effect): corresponding to the effect of exposure
variables on the outcome variable.</li>
<li>OTE (Total Effect): corresponding to the effect of exposure
variables on the outcome variable when the mediators
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>M</mi><mi>S</mi></msup><annotation encoding="application/x-tex">M^S</annotation></semantics></math>
are included in the model.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">her2_status</span><span class="op">$</span><span class="va">oie_med</span> <span class="co"># OIE median for first exposure variable</span></span>
<span><span class="co">#&gt; [1] 0.5827419</span></span>
<span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">her2_status</span><span class="op">$</span><span class="va">ode</span></span>
<span><span class="co">#&gt;      Estimate    Std. Error       t value      Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt; -0.3583404443  0.1034008492 -3.4655464348  0.0005544491</span></span>
<span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">her2_status</span><span class="op">$</span><span class="va">ote</span></span>
<span><span class="co">#&gt;   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt; 0.23037881 0.10591360 2.17515784 0.02987798</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vizualisation-of-results-1">Vizualisation of results<a class="anchor" aria-label="anchor" href="#vizualisation-of-results-1"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_hdmax2.html">plot_hdmax2</a></span><span class="op">(</span><span class="va">hdmax2_step2</span>, plot_type<span class="op">=</span> <span class="st">"all_plot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/brca%20plot%20results%20multivar%20-1.png" width="960"></p>
<ul>
<li><p><strong>A</strong> Estimates of indirect effect (ACME) and
<strong>B</strong> proportions of mediated effect (PM) for the top 10
mediators. The effect estimate is represented by a dot and its 95% CI by
the bar. Symbols correspond to the significance cut off of 5% (square
for p-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\geq 0.05</annotation></semantics></math>,
circle p-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">&lt; 0.05</annotation></semantics></math>).
Colors correspond to the sign of the effect (green for estimated effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\leq 0</annotation></semantics></math>
, red for estimated effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&gt; 0</annotation></semantics></math>).</p></li>
<li><p><strong>C</strong> Effect sizes of Overall Direct Effect (ODE),
Overall Indirect Effect (OIE) and Overall Total Effect (OTE). Error bars
correspond to standard deviation (ODE and OTE) or confidence interval
(OIE).</p></li>
<li><p><strong>D</strong> Indirect effect sizes for the selected
mediators. Black corresponds to the ACME, violet to the effect of
exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on mediator <strong>M</strong>, and blue corresponds to the effect of
mediator <strong>M</strong> on outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p></li>
</ul>
<p>In the <code>plot_hdmax2</code> function it is possible to produce
the 4-plots set or each individual plot with <em>plot_type</em>
argument.</p>
</div>
</div>
<div class="section level2">
<h2 id="nd-use-case-multiple-sclerosis">2nd Use Case : Multiple sclerosis<a class="anchor" aria-label="anchor" href="#nd-use-case-multiple-sclerosis"></a>
</h2>
<p><code>ms_GSE137143</code> was downloaded and processed from the GEO
repository (. 2024 version of the data.)</p>
<p>It is a list of 3 matrices : X (exposure), M (potential mediators), Y
(outcome) :</p>
<ul>
<li>X : exposure variable, a matrix of 104 rows (samples) and 1 column
(gender : female = 1 and male = 0)</li>
<li>M : potential mediators, a matrix of 17283 rows (gene expression)
and 104 columns (samples)</li>
<li>Y : outcome variable, a matrix of 104 rows (samples) and 1 column
(subtype : RR = 1, CIS = 0)</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"ms_GSE137143.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">url_file</span> <span class="op">&lt;-</span> <span class="st">"https://zenodo.org/records/14716548/files/ms_GSE137143.RData?download=1"</span></span>
<span>  <span class="va">response</span> <span class="op">&lt;-</span> <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">GET</a></span><span class="op">(</span><span class="va">url_file</span>, <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/write_disk.html" class="external-link">write_disk</a></span><span class="op">(</span><span class="st">"ms_GSE137143.RData"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">response</span><span class="op">$</span><span class="va">status_code</span> <span class="op">==</span> <span class="fl">200</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"ms_GSE137143.RData"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Download failed"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Number of Latent factore estimation</span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">ms_GSE137143</span><span class="op">$</span><span class="va">M</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Principal Component'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Explained variance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/ms%20pca%20for%20latent%20factor-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">K</span> <span class="op">=</span> <span class="fl">2</span> <span class="co">#The screeplot indicates around 2 main components in the data. </span></span></code></pre></div>
<div class="section level3">
<h3 id="step-1-run-association-studies-2">STEP 1: Run association studies<a class="anchor" aria-label="anchor" href="#step-1-run-association-studies-2"></a>
</h3>
<p>The <strong>run_AS</strong> function is applied to estimate the
effects of exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on a matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>
of potential mediators, and the effect of each potential mediators on
outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
.We also add the age as a known counfouding factor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">CF</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">hdmax2_step1</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/run_AS.html">run_AS</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">ms_GSE137143</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>,</span>
<span>                              outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">ms_GSE137143</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>,</span>
<span>                              M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ms_GSE137143</span><span class="op">$</span><span class="va">M</span><span class="op">)</span>, </span>
<span>                              K <span class="op">=</span> <span class="va">K</span><span class="op">)</span></span></code></pre></div>
<p><em>max-squared</em> test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
results.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_1</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span></span>
<span><span class="co">#&gt;    TSPAN6      DPM1     SCYL3  C1orf112       FGR       CFH </span></span>
<span><span class="co">#&gt; 0.2875623 0.3091126 0.9806292 0.1870420 0.3149651 0.6262667</span></span>
<span></span>
<span></span>
<span><span class="va">pval1</span> <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_1</span><span class="op">$</span><span class="va">pval</span></span>
<span><span class="va">pval2</span> <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">AS_2</span><span class="op">$</span><span class="va">pval</span></span>
<span><span class="va">cor_value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">pval1</span>,<span class="va">pval2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pval1</span>, y <span class="op">=</span> <span class="va">pval2</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pval1</span>, y <span class="op">=</span> <span class="va">pval2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bin_2d.html" class="external-link">geom_bin2d</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"lightblue"</span>, high <span class="op">=</span> <span class="st">"darkblue"</span>, </span>
<span>                      guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"correlation\n = "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_value</span>,<span class="fl">3</span><span class="op">)</span>,<span class="st">"\n \n Count"</span><span class="op">)</span>, </span>
<span>                                             title.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"1srt regresssion (X-&gt;M) pvalues"</span>, y <span class="op">=</span> <span class="st">"2nd regresssion (M-&gt;Y) pvalues"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">data_hdmax2_step1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pvalues <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data_hdmax2_step1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pvalues</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B"</span>, x <span class="op">=</span> <span class="st">"Max2 test pvalues distribution"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span> <span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, top <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="st">"Hypothesis verification"</span>, gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/ms%20step%201%20res%20AS-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="selection-of-a-subset-of-mediators-2">Selection of a subset of mediators<a class="anchor" aria-label="anchor" href="#selection-of-a-subset-of-mediators-2"></a>
</h3>
<p>We selected the top 10 mediators.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Selecting top 10 mediators</span></span>
<span><span class="va">top2_max2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">top2_max2</span></span>
<span><span class="co">#&gt;       MVB12B         NT5E </span></span>
<span><span class="co">#&gt; 2.035825e-06 4.526574e-06</span></span>
<span><span class="va">mediators_top2</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ms_GSE137143</span><span class="op">$</span><span class="va">M</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-2">STEP 2<a class="anchor" aria-label="anchor" href="#step-2-2"></a>
</h3>
<p>The function <code>estimate_effect</code> estimate the individual
indirect effect of mediators, but also overall effects of selected
mediators.</p>
<p>The function <code>estimate_effect</code> takes as inputs, step 1
object and selected mediators matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>M</mi><mi>S</mi></msup><annotation encoding="application/x-tex">M^S</annotation></semantics></math>
from chosen selection method apply on <em>max-squared</em> test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdmax2_step2</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/estimate_effect.html">estimate_effect</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">hdmax2_step1</span>,</span>
<span>                                       m <span class="op">=</span> <span class="va">mediators_top2</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>estimate_effect</code> use
<code><a href="https://rdrr.io/pkg/mediation/man/mediate.html" class="external-link">mediation::mediate</a></code> function to obtain several effects
estimation with uncertainty:</p>
<ul>
<li>ACME Average Causal Mediation Effect: corresponding to the indirect
effect</li>
<li>PM Proportion Mediate: corresponding to the proportion of the total
effect that is mediated by the mediator</li>
<li>TE total effect: which is equal to the sum of direct and indirect
effect</li>
<li>ADE Average Direct Effect: which represents the unmediated
effect</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">gender</span><span class="op">$</span><span class="va">ACME</span><span class="op">)</span></span>
<span><span class="co">#&gt;           est      CI_2.5    CI_97.5  pval   feat</span></span>
<span><span class="co">#&gt; 1 -0.09077507 -0.18840144 -0.0192288 0.008 MVB12B</span></span>
<span><span class="co">#&gt; 2  0.06707219  0.01431824  0.1531602 0.004   NT5E</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">gender</span><span class="op">$</span><span class="va">PM</span><span class="op">)</span></span>
<span><span class="co">#&gt;          est      CI_2.5     CI_97.5  pval   feat</span></span>
<span><span class="co">#&gt; 1  0.2889819  0.05283715  1.16352534 0.010 MVB12B</span></span>
<span><span class="co">#&gt; 2 -0.2017068 -1.22826625 -0.03548262 0.004   NT5E</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">gender</span><span class="op">$</span><span class="va">TE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          est     CI_2.5    CI_97.5  pval   feat</span></span>
<span><span class="co">#&gt; 1 -0.2959140 -0.4642874 -0.1066426 0.002 MVB12B</span></span>
<span><span class="co">#&gt; 2 -0.3038123 -0.4661981 -0.1013277 0.000   NT5E</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">gender</span><span class="op">$</span><span class="va">ADE</span><span class="op">)</span></span>
<span><span class="co">#&gt;          est     CI_2.5    CI_97.5 pval   feat</span></span>
<span><span class="co">#&gt; 1 -0.1706299 -0.3470438  0.0152979 0.08 MVB12B</span></span>
<span><span class="co">#&gt; 2 -0.4403246 -0.6012640 -0.2331373 0.00   NT5E</span></span></code></pre></div>
<p>This step also compute Overall effects :</p>
<ul>
<li>OIE (Indirect effect): corresponding to the sum of the indirect
effect associated with all mediators.</li>
<li>ODE (Direct Effect): corresponding to the effect of exposure
variables on the outcome variable.</li>
<li>OTE (Total Effect): corresponding to the effect of exposure
variables on the outcome variable when the mediators
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>M</mi><mi>S</mi></msup><annotation encoding="application/x-tex">M^S</annotation></semantics></math>
are included in the model.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">gender</span><span class="op">$</span><span class="va">oie_med</span> <span class="co"># OIE median for first exposure variable</span></span>
<span><span class="co">#&gt; [1] 0.02444527</span></span>
<span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">gender</span><span class="op">$</span><span class="va">ode</span></span>
<span><span class="co">#&gt;     Estimate   Std. Error      z value     Pr(&gt;|z|) </span></span>
<span><span class="co">#&gt; -1.824871656  0.686797321 -2.657074510  0.007882202</span></span>
<span><span class="va">hdmax2_step2</span><span class="op">$</span><span class="va">effects</span><span class="op">$</span><span class="va">gender</span><span class="op">$</span><span class="va">ote</span></span>
<span><span class="co">#&gt;     Estimate   Std. Error      z value     Pr(&gt;|z|) </span></span>
<span><span class="co">#&gt; -1.604244218  0.548823596 -2.923059847  0.003466099</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="vizualisation-of-results-2">Vizualisation of results<a class="anchor" aria-label="anchor" href="#vizualisation-of-results-2"></a>
</h3>
<p>We propose a set of plots including:</p>
<ul>
<li><p>Mediators ACME Forest plot</p></li>
<li><p>Mediators PM Forest plot</p></li>
<li><p>Comparison of ODE, OIE and OTE</p></li>
<li><p>Mediators effect size representation</p></li>
</ul>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_hdmax2.html">plot_hdmax2</a></span><span class="op">(</span><span class="va">hdmax2_step2</span>, plot_type<span class="op">=</span> <span class="st">"all_plot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/ms%20plot%20results%20multivar%20-1.png" width="960"></p>
<ul>
<li><p><strong>A</strong> Estimates of indirect effect (ACME) and
<strong>B</strong> proportions of mediated effect (PM) for the top 10
mediators. The effect estimate is represented by a dot and its 95% CI by
the bar. Symbols correspond to the significance cut off of 5% (square
for p-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">\geq 0.05</annotation></semantics></math>,
circle p-value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">&lt; 0.05</annotation></semantics></math>).
Colors correspond to the sign of the effect (green for estimated effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\leq 0</annotation></semantics></math>
, red for estimated effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">&gt; 0</annotation></semantics></math>).</p></li>
<li><p><strong>C</strong> Effect sizes of Overall Direct Effect (ODE),
Overall Indirect Effect (OIE) and Overall Total Effect (OTE). Error bars
correspond to standard deviation (ODE and OTE) or confidence interval
(OIE).</p></li>
<li><p><strong>D</strong> Indirect effect sizes for the selected
mediators. Black corresponds to the ACME, violet to the effect of
exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
on mediator <strong>M</strong>, and blue corresponds to the effect of
mediator <strong>M</strong> on outcome
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p></li>
</ul>
<p>In the <code>plot_hdmax2</code> function it is possible to produce
the 4-plots set or each individual plot with <em>plot_type</em>
argument.</p>
</div>
</div>
<div class="section level2">
<h2 id="helper-functions">Helper Functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h2>
<p>In this vignette, we also provide a series of helper function to
process the data.</p>
<div class="section level3">
<h3 id="how-to-analyse-agregated-methylated-regions">How to analyse agregated methylated regions ?<a class="anchor" aria-label="anchor" href="#how-to-analyse-agregated-methylated-regions"></a>
</h3>
<p>We simulated 100 samples and 200 potential DNA methylation mediators,
with various a binary exposure (smoking status of mothers) and
continuous outcomes (birth weight).</p>
<div class="section level4">
<h4 id="identifying-aggregated-mediator-regions-amr">Identifying aggregated mediator regions (AMR)<a class="anchor" aria-label="anchor" href="#identifying-aggregated-mediator-regions-amr"></a>
</h4>
<p>Identify Aggregated Methylated Regions (AMR) with
<code>AMR_search</code> function which uses from the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
from <em>max-squared</em> test compute in <code>run_AS</code> function
and using a adapted <em>comb-p</em> method (<em>comb-p</em> is a tool
that manipulates BED files of possibly irregularly spaced
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
and calculates auto-correlation, combines adjacent
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values,
performs false discovery adjustment, finds regions of enrichment and
assigns significance to those regions). AMR identification could be
useful in Epigenomic Wide Association Studies (EWAS) when single CpG
mediation is unsuccessful, or could be complementary analysis.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">helper_ex</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="va"><a href="../reference/helper_ex.html">helper_ex</a></span></span>
<span></span>
<span><span class="va">pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">helper_ex</span><span class="op">$</span><span class="va">methylation</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pc</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"b"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'Principal Component'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Explained variance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/AMR%20-1.png" width="700"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># chosen number of dimension</span></span>
<span><span class="va">K</span><span class="op">=</span><span class="fl">5</span></span></code></pre></div>
<div class="section level5">
<h5 id="step-1-run-association-studies-3">STEP 1: Run association studies<a class="anchor" aria-label="anchor" href="#step-1-run-association-studies-3"></a>
</h5>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## run hdmax2 step1</span></span>
<span><span class="va">hdmax2_step1</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/run_AS.html">run_AS</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">exposure</span>,</span>
<span>                              outcome <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">phenotype</span>,</span>
<span>                              M <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">methylation</span>, </span>
<span>                              K <span class="op">=</span> <span class="va">K</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="detecting-amr">Detecting AMR<a class="anchor" aria-label="anchor" href="#detecting-amr"></a>
</h5>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">seed</span> <span class="op">=</span> <span class="fl">0.7</span> <span class="co">#Careful to change this parameter when working with real data</span></span>
<span><span class="va">res.amr_search</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/AMR_search.html">AMR_search</a></span><span class="op">(</span>chr <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">chr</span>,</span>
<span>                                    start <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">start</span>,</span>
<span>                                    end <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">end</span>,</span>
<span>                                    pval <span class="op">=</span> <span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span>,</span>
<span>                                    cpg <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">annotation</span><span class="op">$</span><span class="va">cpg</span>,</span>
<span>                                    seed <span class="op">=</span> <span class="va">seed</span>, </span>
<span>                                    nCores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res.amr_search</span><span class="op">$</span><span class="va">res</span></span>
<span><span class="co">#&gt;   chr  start    end          p        fdr</span></span>
<span><span class="co">#&gt; 3   1 864893 865027 0.03604853 0.05184658</span></span>
<span><span class="co">#&gt; 2   1 858380 858381 0.03901609 0.05184658</span></span>
<span><span class="co">#&gt; 4   1 886431 886553 0.04077365 0.05184658</span></span>
<span><span class="co">#&gt; 5   1 896773 896774 0.05000351 0.05184658</span></span>
<span><span class="co">#&gt; 1   1 854778 855056 0.05184658 0.05184658</span></span>
<span></span>
<span><span class="va">res.arm_build</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/AMR_build.html">AMR_build</a></span><span class="op">(</span><span class="va">res.amr_search</span>, </span>
<span>                                  methylation <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">methylation</span>, </span>
<span>                                  nb_cpg <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#List of DMR selected</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res.arm_build</span><span class="op">$</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt;    DMR chr  start    end          p        fdr nb</span></span>
<span><span class="co">#&gt; 1 DMR1   1 886431 886553 0.04077365 0.05184658  3</span></span>
<span><span class="co">#&gt; 2 DMR2   1 854778 855056 0.05184658 0.05184658  6</span></span>
<span></span>
<span><span class="co">##CpG in the DMR</span></span>
<span><span class="va">res.arm_build</span><span class="op">$</span><span class="va">CpG_for_each_AMR</span></span>
<span><span class="co">#&gt; $DMR1</span></span>
<span><span class="co">#&gt; [1] "cg20322444" "cg07983659" "cg11733071"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $DMR2</span></span>
<span><span class="co">#&gt; [1] "cg08029603" "cg16347928" "cg22699361" "cg03890988" "cg21786289"</span></span>
<span><span class="co">#&gt; [6] "cg13897241"</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="quantifying-indirect-effects-step-2">Quantifying indirect effects (Step 2)<a class="anchor" aria-label="anchor" href="#quantifying-indirect-effects-step-2"></a>
</h4>
<p>Like with single mediators analysis <em>esimate_effect</em> function
could be use to estimate different effects of AMR. Also
<code>plot_hdmax2</code> can be applied to step2 results.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## run hdmax2 step2</span></span>
<span><span class="va">object</span> <span class="op">=</span> <span class="va">hdmax2_step1</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">res.arm_build</span><span class="op">$</span><span class="va">AMR_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## selected mediators effects estimation</span></span>
<span></span>
<span><span class="va">hdmax2_step2</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/estimate_effect.html">estimate_effect</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">hdmax2_step1</span>,</span>
<span>                                       m <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_hdmax2.html">plot_hdmax2</a></span><span class="op">(</span><span class="va">hdmax2_step2</span>, plot_type<span class="op">=</span> <span class="st">"all_plot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hdmax2_files/figure-html/step2-1.png" width="960"></p>
</div>
</div>
<div class="section level3">
<h3 id="how-to-select-potential-mediators-using-q-values-and-fdr-control">How to select potential mediators using q-values and FDR control
?<a class="anchor" aria-label="anchor" href="#how-to-select-potential-mediators-using-q-values-and-fdr-control"></a>
</h3>
<p>Several methods can be use to select potential mediators from step1
results of our method, in our main use cases we simply select top 10
mediators to simplify the narrative. Among available methods to select
mediators from mediation test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values,
we can use FDR (False Discovery Rate) control.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Q</mi><annotation encoding="application/x-tex">Q</annotation></semantics></math>-value
is obtained from <em>max-squared</em> test
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>-values
from step 1 with <code><a href="../reference/hdmax2_qvalue.html">hdmax2::hdmax2_qvalue</a></code> function then
bounded by chosen threshold.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## run hdmax2 step1</span></span>
<span><span class="va">hdmax2_step1</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/run_AS.html">run_AS</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">X_binary</span>,</span>
<span>                 outcome <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">Y_continuous</span>,</span>
<span>                 M <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">M1</span>, </span>
<span>                 K <span class="op">=</span> <span class="va">K</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Select candidate mediator  </span></span>
<span><span class="va">q_values</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/hdmax2_qvalue.html">hdmax2_qvalue</a></span><span class="op">(</span><span class="va">hdmax2_step1</span><span class="op">$</span><span class="va">max2_pvalues</span><span class="op">)</span></span>
<span><span class="va">candidate_mediator</span> <span class="op">&lt;-</span> <span class="va">q_values</span><span class="op">$</span><span class="va">qv</span><span class="op">[</span><span class="va">q_values</span><span class="op">$</span><span class="va">qv</span><span class="op">&lt;=</span> <span class="fl">0.2</span><span class="op">]</span> <span class="co"># In this example, we will consider FDR levels &lt;20%.</span></span>
<span><span class="va">candidate_mediator</span></span>
<span><span class="co">#&gt;   cg00026919   cg00035636   cg00049102   cg00049616   cg00050792   cg00055679 </span></span>
<span><span class="co">#&gt; 1.434951e-01 1.748547e-03 2.445138e-03 6.103922e-02 3.891147e-05 6.756850e-02 </span></span>
<span><span class="co">#&gt;   cg00056767   cg00066729   cg00071026   cg00071658   cg00071727   cg00075768 </span></span>
<span><span class="co">#&gt; 5.357341e-02 4.286252e-11 9.843811e-09 1.073321e-04 3.527028e-03 3.897026e-05 </span></span>
<span><span class="co">#&gt;   cg00076854   cg00084432   cg00089444   cg00092518   cg00093478   cg00098553 </span></span>
<span><span class="co">#&gt; 1.909772e-06 4.403319e-06 6.582410e-12 1.581844e-01 2.279497e-05 3.023057e-07 </span></span>
<span><span class="co">#&gt;   cg00102591   cg00119011   cg00121843   cg00124836   cg00126948   cg00127894 </span></span>
<span><span class="co">#&gt; 4.846930e-22 1.376804e-14 3.505372e-03 5.728461e-10 1.650267e-09 1.299045e-05 </span></span>
<span><span class="co">#&gt;   cg01165817 </span></span>
<span><span class="co">#&gt; 6.346643e-02</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-to-transform-a-categorial-variable-into-an-ordered-factor">How to transform a categorial variable into an ordered factor?<a class="anchor" aria-label="anchor" href="#how-to-transform-a-categorial-variable-into-an-ordered-factor"></a>
</h3>
<p>When categorical variables are used as exposure variables,
<code>hdmax2</code> uses the first category as a reference (intercept)
to calculate the effects associated with the variable’s other
categories. The functions <code>HDMAX2::run_AS</code> and
<code>HDMAX2::estimate_effect</code> will transform the character vector
you have used (if any) into a factor, with an arbitrary ordering of the
categories. If order is important to you, here’s a simple way to turn
your character vector into a factor and order the categories as you
wish. You can then use this variable as input to the <code>hdmax2</code>
functions.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># inverse alphabetical order for example</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="va">simu_data</span><span class="op">$</span><span class="va">X_categorial</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">X</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D"</span>,<span class="st">"C"</span>,<span class="st">"B"</span>,<span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-to-handle-adding-an-additional-set-of-covariates-to-the-second-association-study">How to handle adding an additional set of covariates to the second
association study?<a class="anchor" aria-label="anchor" href="#how-to-handle-adding-an-additional-set-of-covariates-to-the-second-association-study"></a>
</h3>
<p>It is possible to add a second adjustment factors set in association
study between potential mediators and outcome if it makes sense from a
biological standpoint. Nevertheless, this additional set of adjustment
factors for the second association study must include the adjustment
factors from the first association study as design in
<code>run_AS</code> function.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First adjustment factors set</span></span>
<span><span class="va">covar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">helper_ex</span><span class="op">$</span><span class="va">covariables</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Second adjustment factors set</span></span>
<span><span class="va">suppl_covar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">helper_ex</span><span class="op">$</span><span class="va">covariables</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hdmax2_step1</span> <span class="op">=</span> <span class="fu">hdmax2</span><span class="fu">::</span><span class="fu"><a href="../reference/run_AS.html">run_AS</a></span><span class="op">(</span>exposure <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">exposure</span>,</span>
<span>                              outcome <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">phenotype</span>,</span>
<span>                              M <span class="op">=</span> <span class="va">helper_ex</span><span class="op">$</span><span class="va">methylation</span>,</span>
<span>                              K <span class="op">=</span> <span class="va">K</span>,</span>
<span>                              covar <span class="op">=</span> <span class="va">covar</span>,</span>
<span>                              suppl_covar <span class="op">=</span> <span class="va">suppl_covar</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Florence Pittion, Magali Richard, Olivier Francois, Basile Jumentier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
